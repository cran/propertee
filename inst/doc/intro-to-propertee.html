<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="propertee Authors" />

<meta name="date" content="2025-08-18" />

<title>Introduction to propertee</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to propertee</h1>
<h4 class="author">propertee Authors</h4>
<h4 class="date">2025-08-18</h4>



<div id="main-features" class="section level2">
<h2>Main Features</h2>
<p>The <strong>propertee</strong> package, Prognostic Regression Offsets
with Propagation of ERrors (for Treatment Effect Estimation),
facilitates direct adjustment or standardization for experiments and
observational studies, with the option of using a separately fitted
prognostic regression model for covariance adjustment. Propertee calls
for a self-standing specification of a study’s design and treatment
allocations, using these to create weights needed to align treatment and
control samples for estimation of treatment effects averaged across a
common standard population, with standard errors that appropriately
reflect the study design. For covariance adjustment it enables
offsetting the outcome against predictions from a dedicated covariance
model, with standard error calculations propagating error as appropriate
from the covariance model.</p>
<p>The main workflow consists of two main steps and one optional
step:</p>
<ol style="list-style-type: decimal">
<li>Encode the study’s design, including the unit of assignment,
treatment status of each unit of assignment, and block membership
information as appropriate, in a <code>StudySpecification</code> object.
This is accomplished with the <code>obs_spec()</code>,
<code>rct_spec()</code> or <code>rd_spec()</code> functions.</li>
<li>Optionally, fit a covariate adjustment model. This is done with any
of a number of modeling functions external to <code>propertee</code>,
for example <code>lm()</code> or <code>glm()</code> from the
<code>stats</code> package, or <code>lmrob</code> from the
<code>robustbase</code> package.</li>
<li>Use <code>lm()</code> to contrast the separately reweighted
treatment and control groups, incorporating optional covariance
adjustments as an <code>offset</code> to <code>lm()</code>. The
<code>StudySpecification</code> is unobtrusively retained, as is error
propagation from the optional covariance adjustment, for use in
subsequent standard error calculations. This is done using the
<code>lmitt()</code> function, which either takes and enriches a fitted
<code>lm</code> or, in the more fully supported usage, internally calls
<code>lm()</code> to itself create a directly adjusted contrast of
treatment conditions.</li>
</ol>
</div>
<div id="example-data" class="section level2">
<h2>Example Data</h2>
<p>The example dataset comes from the state of Tennessee’s
Student-Teacher Achievement Ratio (STAR) experiment. Students were
randomly assigned to three possible classroom conditions: small (13 to
17 students per teacher), regular class (22 to 25 students per teacher),
and regular-with-aide class (22 to 25 students with a full-time
teacher’s aide).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;STARplus&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">table</span>(STARplus<span class="sc">$</span>cond_at_entry)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#&gt;         regular    regular+aide           small nonexperimental </span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#&gt;            4328            4249            3024            1780</span></span></code></pre></div>
<p>For simplicity for this first example, we will examine a single
binary treatment - “small” classrooms versus “regular” and
“regular+aide” classrooms.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>STARplus<span class="sc">$</span>cond_small <span class="ot">&lt;-</span> STARplus<span class="sc">$</span>cond_at_entry <span class="sc">==</span> <span class="st">&quot;small&quot;</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">table</span>(STARplus<span class="sc">$</span>cond_small)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; FALSE  TRUE </span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; 10357  3024</span></span></code></pre></div>
<p>After this basic example, we will see how <strong>propertee</strong>
makes it easy to handle non-binary treatment variables by introducing
<code>dichotomy</code>s.</p>
<p>The outcome of interest is a reading score at the end of
kindergarten.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">summary</span>(STARplus<span class="sc">$</span>g1treadss)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt;   404.0   478.0   516.0   521.5   558.0   651.0    5805</span></span></code></pre></div>
<p>We first take the random assignment scheme to have been either
complete or Bernoulli randomization of students, separately by school.
(Later we’ll change this to the more realistic assumption of complete or
Bernoulli randomization, separately by school <em>and</em> year of entry
into the study.) Accordingly, experimental blocks are given by the
<code>school_at_entry</code> variable.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(STARplus<span class="sc">$</span>school_at_entry))</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt; [1] 81</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">table</span>(STARplus<span class="sc">$</span>school_at_entry))</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; 112038 123056 128068 128076 128079 130085 </span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt;    129     85     54     96    135    135</span></span></code></pre></div>
<p>We need a unique identifier for the unit by which treatment was
allocated. STAR treatments were assigned to students, as opposed to
classrooms or other aggregates of students; accordingly we need a unique
identifier per student. The <code>stdntid</code> variable fills this
role.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(STARplus<span class="sc">$</span>stdntid))</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; [1] 13381</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">head</span>(STARplus<span class="sc">$</span>stdntid)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; [1] 10000 10001 10002 10003 10004 10005</span></span></code></pre></div>
</div>
<div id="a-basic-example" class="section level2">
<h2>A Basic Example</h2>
<div id="defining-the-studyspecification" class="section level3">
<h3>Defining the <code>StudySpecification</code></h3>
<p>The three <code>_spec</code> functions (<code>rct_spec()</code>,
<code>obj_spec()</code>, and <code>rd_spec()</code>) operate similarly.
The first argument is the most important, and encodes all the
specification information through the use of a formula. The left-hand
side of the formula identifies the treatment variable. The right-hand
side of the formula consists of the following potential pieces of
information:</p>
<ol style="list-style-type: decimal">
<li><code>unit_of_assignment()</code>: This identifies the variable(s)
which indicate the units of assignment. This is required for all
specifications. The alias <code>uoa()</code> can be used in its
place.</li>
<li><code>block()</code>: The identifies the variable(s) which contain
block information. Optional.</li>
<li><code>forcing()</code>: In regression discontinuity specifications
(<code>rd_spec()</code>), this identifies the variable(s) which contain
forcing information.</li>
</ol>
<p>To define a <code>StudySpecification</code> in our example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>spec <span class="ot">&lt;-</span> <span class="fu">obs_spec</span>(cond_small <span class="sc">~</span> <span class="fu">unit_of_assignment</span>(stdntid) <span class="sc">+</span> <span class="fu">block</span>(school_at_entry),</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>                  <span class="at">data =</span> STARplus, <span class="at">na.fail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="fu">summary</span>(spec)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; Observational Study</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt;  Structure          Variables      </span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt;  ---------          ---------      </span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt;  Treatment          cond_small     </span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt;  Unit of Assignment stdntid        </span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt;  Block              school_at_entry</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; Number of units per Treatment group: </span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt;  Txt Grp Num Units</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt;    FALSE      8577</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt;     TRUE      3024</span></span></code></pre></div>
<p>Should additional variables be needed to identify the unit of
assignment, block, or forcing, they can be included. Had the variable
identifying the years in which participants entered the study been
available, for example, we might have identified the experimental blocks
as combinations of school and year of study entry, rather than as the
school alone. To do this we would pass
<code>block(year_at_entry, school_at_entry)</code>, rather than
<code>block(school_at_entry)</code>, in the above.</p>
</div>
<div id="estimating-the-treatment-effect" class="section level3">
<h3>Estimating the treatment effect</h3>
<p>The main function for estimating treatment effects is the
<code>lmitt()</code> function. It takes in three main required
arguments:</p>
<ol style="list-style-type: decimal">
<li>A formula specifying the outcome and the desired treatment
effect.</li>
<li>The data set containing the outcome information.</li>
<li>A <a href="#defining-the-specification"><code>StudySpecification</code></a>.</li>
</ol>
<p>Note that the data set does <strong>not</strong> need to be the same
data set which generated the <code>StudySpecification</code>; it does
however need to include the same variables to identify the units of
assignment. (If the variable names differ, the <code>by=</code> argument
can be used to link them, though we recommend renaming to reduce the
likelihood of issues.)</p>
<p>For example, you may have one dataset containing school-level
information, and a separate dataset containing student-level
information. Assume school is the unit of assignment. While you could of
course merge those two data-sets, <strong>propertee</strong> can instead
use the school-level data to define the <code>StudySpecification</code>,
and the student-level data to estimate the treatment effect.</p>
<p>The formula entering <code>lmitt()</code> can take on one of two
forms:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>y <span class="sc">~</span> <span class="dv">1</span></span></code></pre></div>
<p>will estimate the main treatment effect on outcome variable
<code>y</code>, and</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>y <span class="sc">~</span> x</span></code></pre></div>
<p>will estimate subgroup specific treatment effects for each level of
<code>x</code> for the outcome <code>y</code>, if <code>x</code> is
categorical. For continuous <code>x</code>, a main effect and a
treatment-<code>x</code> interaction effect is estimated.</p>
<p>Therefore, to estimate the treatment effect in our example, we can
run:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>te <span class="ot">&lt;-</span> <span class="fu">lmitt</span>(g1treadss <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> STARplus, <span class="at">specification =</span> spec)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt; The StudySpecification object contains block-level information, but it is not used in this model. Block information is used when weights are defined via `ate()` or `ett()` or if the `absorb=TRUE` argument is passed.</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="fu">summary</span>(te)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; lmitt(g1treadss ~ 1, data = STARplus, specification = spec)</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt;  Treatment Effects :</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt;                       Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; cond_small.TRUE        12.6024     1.5938   7.907 2.84e-15 ***</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; g1treadss:(Intercept) 517.4628     0.7898 655.150  &lt; 2e-16 ***</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt; Std. Error calculated via type &quot;HC0&quot;</span></span></code></pre></div>
<p>The data includes ethnicity; we can estimate subgroup effects by
ethnicity:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>te_s <span class="ot">&lt;-</span> <span class="fu">lmitt</span>(g1treadss <span class="sc">~</span> race, <span class="at">data =</span> STARplus, <span class="at">specification =</span> spec)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#&gt; The StudySpecification object contains block-level information, but it is not used in this model. Block information is used when weights are defined via `ate()` or `ett()` or if the `absorb=TRUE` argument is passed.</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="fu">summary</span>(te_s)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt; Warning: The following subgroups do not have sufficient degrees of freedom for</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt; standard error estimates and will be returned as NA: racemssng</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; lmitt(g1treadss ~ race, data = STARplus, specification = spec)</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; Treatment Effects: (1 not defined because of singularities)</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt;                           Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; cond_small.TRUE_racewhite   9.6229     1.9779   4.865 1.16e-06 ***</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt; cond_small.TRUE_raceblack  16.4164     2.3296   7.047 1.92e-12 ***</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt; cond_small.TRUE_raceasian -19.3846    29.7818  -0.651    0.515    </span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt; cond_small.TRUE_racehispa  43.1667    50.6159   0.853    0.394    </span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt; cond_small.TRUE_racenatam  12.5000    37.2522   0.336    0.737    </span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#&gt; cond_small.TRUE_raceother   8.0000    30.4991   0.262    0.793    </span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt; cond_small.TRUE_racemssng       NA         NA      NA       NA    </span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co">#&gt; g1treadss:racewhite       530.4149     0.9873 537.252  &lt; 2e-16 ***</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co">#&gt; g1treadss:raceblack       492.0263     1.0665 461.335  &lt; 2e-16 ***</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="co">#&gt; g1treadss:raceasian       552.3846    16.8166  32.848  &lt; 2e-16 ***</span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a><span class="co">#&gt; g1treadss:racehispa       526.5000    25.1480  20.936  &lt; 2e-16 ***</span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a><span class="co">#&gt; g1treadss:racenatam       490.0000    26.1639  18.728  &lt; 2e-16 ***</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a><span class="co">#&gt; g1treadss:raceother       547.0000    19.0245  28.752  &lt; 2e-16 ***</span></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a><span class="co">#&gt; g1treadss:racemssng       480.0000         NA      NA       NA    </span></span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a><span class="co">#&gt; Std. Error calculated via type &quot;HC0&quot;</span></span></code></pre></div>
</div>
<div id="including-specification-weights" class="section level3">
<h3>Including specification weights</h3>
<p>Study specification weights can be easily included in this
estimation. <strong>propertee</strong> supports average treatment effect
(ATE) and effect of the treatment on the treated (ETT) weights.</p>
<p>To include one of the weights, simply include the
<code>weights = &quot;ate&quot;</code> or <code>weights = &quot;ett&quot;</code> argument to
<code>lmitt()</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">lmitt</span>(g1treadss <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> STARplus, <span class="at">specification =</span> spec, <span class="at">weights =</span> <span class="st">&quot;ate&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt;       cond_small.TRUE g1treadss:(Intercept) </span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt;              11.35214             517.91270</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="fu">lmitt</span>(g1treadss <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> STARplus, <span class="at">specification =</span> spec, <span class="at">weights =</span> <span class="st">&quot;ett&quot;</span>)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt;       cond_small.TRUE g1treadss:(Intercept) </span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt;              10.88851             519.17669</span></span></code></pre></div>
<p>Internally, these call the <code>ate()</code> or <code>ett()</code>
functions which can be used directly.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">ate</span>(spec, <span class="at">data =</span> STARplus))</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt; [1] 1.448276 1.237013 1.433071 1.413793 1.675676 1.361345</span></span></code></pre></div>
<p>When included inside <code>lmitt()</code>, you do not need to specify
any additional arguments to <code>ate()</code> or <code>ett()</code>,
enabling easy functions of weights. For example if you had some other
weight variable, say <code>wgt</code>, you could include
<code>weights = wgt*ate()</code> in the <code>lmitt()</code> call.</p>
</div>
<div id="covariance-adjustment-models" class="section level3">
<h3>Covariance Adjustment models</h3>
<p>By itself, <code>lmitt()</code> does not allow for other covariates;
e.g. something like <code>lmitt(y ~ 1 + control_var,...</code> will
fail. To adjust for covariates, a separate covariate model should be
fit. Any model which supports a <code>predict()</code> function should
work.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>camod <span class="ot">&lt;-</span> <span class="fu">lm</span>(g1treadss <span class="sc">~</span> gender <span class="sc">*</span> dob <span class="sc">+</span> race, <span class="at">data =</span> STARplus)</span></code></pre></div>
<p>The <code>cov_adj()</code> function can be used to process the
covariance adjustment model and produce the required values; and its
output can be passed as an <code>offset=</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">lmitt</span>(g1treadss <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> STARplus, <span class="at">specification =</span> spec,</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>      <span class="at">weights =</span> <span class="st">&quot;ate&quot;</span>, <span class="at">offset =</span> <span class="fu">cov_adj</span>(camod))</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt;       cond_small.TRUE g1treadss:(Intercept) </span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt;              11.03055             517.91270</span></span></code></pre></div>
<p>Similarly to the weight functions, <code>cov_adj()</code> attempts to
locate the correct arguments (in this case, mainly the
<code>data=</code> argument) to use in the model command; while
<code>cov_adj()</code> does fall back to using the data which is in the
covariance model, its safer to use the <code>newdata=</code> argument if
calling <code>cov_adj()</code> outside of the model.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">cov_adj</span>(camod, <span class="at">newdata =</span> STARplus))</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#&gt; [1] 519.6613 528.8581 495.1975 531.1456 500.2958 490.3070</span></span></code></pre></div>
<p>Also, similarly to weights, <code>cov_adj()</code> can be used in
normal modeling commands as well.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">lm</span>(g1treadss <span class="sc">~</span> cond_small, <span class="at">data =</span> STARplus, <span class="at">weights =</span> <span class="fu">ate</span>(spec),</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>   <span class="at">offset =</span> <span class="fu">cov_adj</span>(camod))</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt; lm(formula = g1treadss ~ cond_small, data = STARplus, weights = ate(spec), </span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt;     offset = cov_adj(camod))</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt;    (Intercept)  cond_smallTRUE  </span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt;         -3.266          11.031</span></span></code></pre></div>
</div>
<div id="absorbing-blocks" class="section level3">
<h3>Absorbing Blocks</h3>
<p>If fixed effects for blocks are desired, which can be absorbed away
to avoid estimating, the <code>absorb=TRUE</code> argument can be
passed.</p>
<!-- currently not working due to #210, thus turned off-->
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">lmitt</span>(g1treadss <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> STARplus, <span class="at">specification =</span> spec, <span class="at">absorb =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
